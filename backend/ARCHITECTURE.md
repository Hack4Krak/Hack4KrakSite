# Code architecture

## üì¶ Crates

Our codebase consists of few crates:
- [`macros/`](macros/) - Contains macros used in the main crate.
- [`migration/`](migration/) - Contains [SeaORM](https://www.sea-ql.org/SeaORM/) migrations
- [`openapi-cli/`](openapi-cli/) - Contains executable CLI used for generating and verifying OpenAPI specification from our codebase.
- [`src/`](src/) - Main crate with all the business logic.

## üèóÔ∏è Modules

The main crate is organized into several modules, each responsible for a specific part of the application. The modules are as follows:

- [`entities/`](src/entities/) - Entities generated by SeaORM. These are the database models that represent the tables in our database.\
    You can generate them by using `seaorm-cli` - more information [here](DEVELOPMENT.md#-managing-database).
- [`middlewares/`](src/middlewares/) - Middlewares used in the application.
- [`models/`](src/models/) - Low level logic related to specific models and database entities.\
    It shouldn't have complex logic, relation between models or any complex logic.
- [`routes/`](src/routes/) - Contains all the routes used in the application.\
    Each route is defined in a separate file, and the files are organized into subdirectories based on the paths.\
    All modules have `mod.rs` with `config` function used to register handlers and sometimes `thiserror` error enum.
- [`services/`](src/services/) - Contains all the services used in the application - objects with higher abstractions accessible from all routes.\
    One of the most important ones is [env.rs](src/services/env.rs) - the service that loads and manages environment variables.
- [`utils/`](src/utils/) - Very simple utility functions that are used in multiple places.\
    It shouldn't contain any complex logic or relation between modules.

## ‚ùì Other
- [`tests/`](tests/) - Contains integration tests for the application.\
    Slow or expensive ones are marked with `#[cfg(feature = "full-test-suite")]` attribute.
- [`TasksTemplate/`](TasksTemplate) - Git submodule of the [TaskTemplate](https://github.com/Hack4Krak/TasksTemplate) repository.\
    It is used to define CTF tasks in a data-driven way.